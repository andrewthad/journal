# PL Thoughts

I'm burning out on this again, but here's a few thoughts for my future self
whenever I pick this back up:

* I need to separate unboxed ADTs and boxed ADTs a little better. In the
  typed AST, it's probably worth having separate data constructors for
  allocating each of these. It might be good to separate them for scrutinee
  as well. They are each typechecked a little differently, but I think the
  common parts could be factored out and reused. Lowering scrutinee to C
  is also similar but a little different. It's probably worth adding another
  type argument to the `Adt` type to indicate whether or not it is boxed.
  Also, in the user-facing syntax of the language, it probably makes sense
  to distinguish `alloc Person(name, age)(hnd)` and `value Person(name, age)`.
  The second one is not associated with a region and does not need a handle.
  In C, it's just a stack-allocated struct (and we never take its address).
* Top-level values, especially for string literals, are an important feature.
  I can probably do this in phases and just support strings first. Lowering
  this to C is simple. It might be more difficult create data with pointers
  to other data, but that's not as critical.
* I need to figure out how to deal with user-defined types. I've been happy
  to kick this can down the road. All the shenanigans I've done for built-in
  types have helped inform what I would do for user-defined types.
* One reason that I like having some of the unboxed tagged unions built into
  the compiler is that I can pack the corresponding C structs to be 16 bytes
  or less. I'm not sure if I can write a program that can do this as well as
  I can by hand. This doesn't really matter, but it's a good thing to be
  aware of.
* Embracing little `static inline` functions has been a good decision. When
  lowering anything that needs to conjure up a fresh C variable, this is a
  good way to do things.
* I wrote about these on 2025-09-08, but I need to add (simple) type inference,
  and I should relax ANF.
* I need to add another stage (I already have unchecked and checked) to the
  stage pipeline. There needs to be a stage that includes the analysis that
  is needed for deallocating regions.
* I need to spend time just writing out what I think a standard library ought
  to look like. I'm happy to have an enormous number of built-in functions
  (compiled both inline and out-of-line). But I still need to figure out what
  some of the APIs should look like. This should be easier now that I've
  figured out most of the type system.
* I should decide whether I want to use linear types or unique types. I can
  probably design a lot of the standard library without commiting to either,
  but at some point, I need to pick one of these. Linear types are more common,
  but unique types have semantics that actually match what I'm using this for.
* If most of the standard library is going to be written in the language
  itself, I need to decide on a namespacing strategy. I also need to figure
  out how to build and reuse the standard library.
