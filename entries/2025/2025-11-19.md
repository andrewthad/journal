# Reference Counting And Regions

I think reference-counted types (packed regions and non-region-tracked data)
need to have a kind that is separate from types whose lifetimes are pinned
to a region. Here are the reasons:

* It is not safe to store reference-counted data in a region. When the region
  goes out of scope, it's not possible to trace it and find every RC that
  needs to be decremented. Separating the kinds makes this easier to enforce.
* Polymorphic code that does not need to worry about reference counts is
  more simple. Supporting RC objects and non-RC objects in the same compiled
  polymorpic function introduces branching. And these branches are probably
  not needed in many cases.

So, what we end up with is a fragmented system. There is an RC fragment and
a region fragment. We can lift a region-lifetimed object into the RC fragment
by packing the region. But we cannot lift in the other direction. Practically,
what this means is that data structures can only be designed to handle either
RC objects or non-RC objects. I think this is probably fine though because
data structure that store reference-counted elements will need to be designed
in a way that avoids lots of RC updates.
