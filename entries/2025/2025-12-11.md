# HTML Templating

I've been thinking about how to do something like the Haskell library heist
but differently. Here are the characteristics I'm looking for:

* I do not need the ability to run database queries (or perform any IO)
  while interpreting a template. Heist, like many Haskell libraries,
  has a type that is layered on top of a monad (actually, it's got two
  monads, one for load time and one for run time). Basically, I don't
  need that for any templates that I ever write.
* I want to be able to print out all of the substitutions that are available
  as a kind of documentation for the user.
* I want to be able to do some kinds of static analysis. There's general
  stuff like "cannot nest paragraph elements inside one another", but there
  are also some framework-specific checks. For example, in bootstrap, columns
  are supposed to go inside rows.

The types that I have come up with looks like this: 

    newtype Substitutions a = Substitutions (Map Text (Field a))
    data Field a
      = String (a -> Text)
      | Integer (a -> Integer)
      | forall b. Array (a -> SmallArray b) (Substitutions b)

This departs for heist. Here, `Substitutions` gives us a way to extract
data, but it does not give us a way to encode that data. All of the knobs
to control encoding are attributes on the `<x-var/>` element.

This is less flexible than heist. But it gives me a better starting point
for my common use cases. For example, I can use `<x-foreach ref="Accounts">`
to enumerate the accounts belonging to some parent resource. And I can do
this for any array resource without having to define the splice every time.

There are a few pain points. One thing that I want to be able to do is
build bootstrap rows of columns, a sort of chunked `foreach`:

    <x-bootstrap-rows-of-columns ref="People" columns-per-row="4">
      <h1><x-var ref="PersonName"></h1>
    </x-bootstrap-rows-of-columns>

This is very specific to bootstrap, but I think it should just build it in.
I've built a more general "chunked foreach" function, but it's just too
complicated to use.

Something else that I still need to figure out is how to let the user
define their own "functions". These should accept at most a single HTML
argument (which would be passed as the children when calling the function).
Any other arguments would need to be passed as attributes. There is no way
to typecheck these because the user cannot provide annotations. Well, we
could do a little bit of typechecking. We could ban any kind of composite
type. That might be the best thing to do. And then we could require that
the "functions" be passed things like strings or integers as certain
arguments.

Building forms is always a pain. It would be nice to be able to say something
like "here's a list of fields available in the context, generate an input for
each of them, possibly filled in with an existing value". There are a lot of
layout-related issues with doing this. People want certain form elements
laid out horizontally. So I'm not sure if this works well in practice.

Also, related to forms, there's the issue of validation. If validation is
done on the server, it needs to be possible to display a validation failure
when building the form. So we need fields for all of those too.


